<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Internal Knowledge Assistant</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="{{ url_for('static', filename='img/favicon.ico') }}"
    />
    <!-- CSS Modules -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/variables.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/auth.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/config.css') }}" />
  </head>
  <body>
    {% set is_auth_page = request.path in ["/login", "/signup"] %}
    {% set protected_routes = ['/', '/configure'] %}
    {% set is_protected = request.path in protected_routes %}
    {% if not is_auth_page %}
    <nav id="main-nav" {% if is_protected %}style="display: none;"{% endif %}>
      <div class="nav-left">
        <a href="/" class="logo-link">
          <img
            src="{{ url_for('static', filename='img/logo.png') }}"
            alt="Knowledge Assistant Logo"
            class="nav-logo"
          />
          <div class="logo">Knowledge Assistant</div>
        </a>
      </div>
      <div class="nav-center nav-links">
        <a href="/" id="chat-link" style="display: none">Chat</a>
        <a href="/configure" id="config-link" style="display: none"
          >Configure</a
        >
      </div>
      <div class="nav-right nav-links">
        <a href="/login" id="login-link">Login</a>
        <div id="user-menu" class="user-menu" style="display: none">
          <button
            id="user-menu-btn"
            type="button"
            aria-haspopup="true"
            aria-expanded="false"
          >
            <span id="user-avatar">U</span>
          </button>
          <div id="user-menu-dropdown" class="user-menu-dropdown">
            <div class="user-menu-name" id="user-name">User</div>
            <div class="user-menu-email" id="user-email">user@example.com</div>
            <button id="logout-link" type="button">Logout</button>
          </div>
        </div>
      </div>
    </nav>
    {% endif %}

    <div id="app-toast" class="app-toast" style="display: none">
      <div class="app-toast-body">
        <div class="app-toast-icon" id="app-toast-icon"></div>
        <div class="app-toast-content">
          <span id="app-toast-message"></span>
        </div>
        <button id="app-toast-ok" type="button">OK</button>
      </div>
    </div>

    <div id="main-content" {% if is_protected %}style="display: none;"{% endif %}>{% block content %}{% endblock %}</div>

    <footer class="app-footer">
      <div class="footer-content">
        <div class="footer-links">
          <a href="/privacy">Privacy Policy</a>
          <a href="/terms">Terms of Service</a>
          <a href="mailto:arjuntheprogrammer@gmail.com">Contact Support</a>
        </div>
        <div class="footer-copyright">
          &copy; 2026 Internal Knowledge Assistant. Powered by Google Cloud
        </div>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"></script>
    <script src="https://apis.google.com/js/api.js" async defer></script>
    <script
      type="module"
      src="{{ url_for('static', filename='app.js') }}"
    ></script>
  </body>
</html>
